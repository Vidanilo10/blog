<div class="music-container">
  <h1>Music Collection</h1>

  <!-- Spotify Connection Section -->
  <section class="music-section spotify-auth-section" *ngIf="!isSpotifyConnected">
    <h2>ğŸµ Connect Your Spotify</h2>
    <p class="connect-description">
      Connect your Spotify account to see your personal playlists and favorite tracks!
    </p>
    <button class="spotify-connect-btn" (click)="connectSpotify()">
      <span class="spotify-icon">â™«</span> Connect with Spotify
    </button>
  </section>

  <!-- Loading Indicator -->
  <section class="music-section loading-section" *ngIf="isSpotifyConnected && isLoading">
    <div class="loading-spinner">
      <p>Loading your Spotify data...</p>
    </div>
  </section>

  <!-- User Profile Section -->
  <section class="music-section user-profile-section" *ngIf="isSpotifyConnected && userProfile">
    <div class="section-header">
      <div class="profile-info">
        <img *ngIf="userProfile.images && userProfile.images.length > 0" 
             [src]="userProfile.images[0].url" 
             alt="Profile" 
             class="profile-image">
        <div>
          <h2>Welcome, {{ userProfile.display_name }}! ğŸµ</h2>
          <p class="profile-stats">
            {{ userProfile.followers?.total || 0 }} followers
            <span *ngIf="userPlaylists.length > 0"> â€¢ {{ userPlaylists.length }} playlists</span>
          </p>
        </div>
      </div>
      <button class="disconnect-btn" (click)="disconnectSpotify()">Disconnect</button>
    </div>
  </section>

  <!-- Top Tracks Section -->
  <section class="music-section" *ngIf="isSpotifyConnected && topTracks.length > 0">
    <h2>ğŸ”¥ Your Top Tracks</h2>
    <div class="tracks-grid">
      <div class="track-card" *ngFor="let track of topTracks.slice(0, 10); let i = index">
        <div class="track-number">{{ i + 1 }}</div>
        <img [src]="track.album.images[0].url" [alt]="track.name" class="track-image">
        <div class="track-info">
          <h3 class="track-name">{{ track.name }}</h3>
          <p class="track-artist">{{ track.artists[0].name }}</p>
          <p class="track-album">{{ track.album.name }}</p>
        </div>
        <a [href]="track.external_urls.spotify" target="_blank" class="play-btn" title="Play on Spotify">
          â–¶
        </a>
      </div>
    </div>
  </section>

  <!-- User Playlists Section -->
  <section class="music-section" *ngIf="isSpotifyConnected && userPlaylists.length > 0">
    <h2>ğŸ“š Your Playlists</h2>
    <div class="playlists-grid">
      <div class="playlist-card" *ngFor="let playlist of userPlaylists.slice(0, 6)">
        <iframe 
          [src]="getSafeSpotifyPlaylistUrl(playlist.id)"
          width="100%" 
          height="380" 
          frameBorder="0" 
          allowfullscreen="" 
          allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
          loading="lazy">
        </iframe>
        <p class="playlist-name">{{ playlist.name }}</p>
      </div>
    </div>
  </section>

  <!-- Default Spotify Section -->
  <section class="music-section">
    <h2>ğŸµ Featured Playlist</h2>
    <div class="spotify-container">
      <iframe 
        [src]="spotifyPlaylistUrl"
        width="100%" 
        height="380" 
        frameBorder="0" 
        allowfullscreen="" 
        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
        loading="lazy">
      </iframe>
    </div>
    <p class="api-info">
      <strong>Note:</strong> To customize this with your own playlists:
      <br>1. Get a Spotify playlist share link
      <br>2. Replace the playlist ID in the component
      <br>3. For advanced features, connect your Spotify account above!
    </p>
  </section>

  <!-- YouTube Section - Favorite/Liked Videos -->
  <section class="music-section">
    <div class="section-header">
      <h2>â­ {{ isYouTubeConnected ? 'Your Liked Videos' : 'Featured Music Videos' }}</h2>
      <button class="youtube-connect-btn" *ngIf="!isYouTubeConnected" (click)="connectYouTube()">
        Connect YouTube
      </button>
      <button class="disconnect-btn" *ngIf="isYouTubeConnected" (click)="disconnectYouTube()">
        Disconnect YouTube
      </button>
    </div>

    <div class="youtube-loading" *ngIf="isYouTubeLoading">
      <p>Loading your liked videos...</p>
    </div>
    
    <div class="youtube-grid" *ngIf="isYouTubeConnected && !isYouTubeLoading">
      <div class="youtube-card" *ngFor="let video of likedVideos">
        <div class="video-thumbnail">
          <iframe 
            [src]="getSafeYoutubeUrl(video.id)"
            width="100%" 
            height="200" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen
            loading="lazy">
          </iframe>
        </div>
        <div class="video-details">
          <h3 class="video-title">{{ video.title }}</h3>
          <p class="video-channel">{{ video.channelTitle }}</p>
        </div>
      </div>
    </div>

    <div class="youtube-grid" *ngIf="!isYouTubeConnected">
      <div class="youtube-card" *ngFor="let video of favoriteVideos">
        <div class="video-thumbnail">
          <iframe 
            [src]="getSafeYoutubeUrl(video.id)"
            width="100%" 
            height="200" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen
            loading="lazy">
          </iframe>
        </div>
      </div>
    </div>

    <p class="connect-hint" *ngIf="!isYouTubeConnected">
      ğŸ’¡ Connect your YouTube account to see your actual liked videos!
    </p>
  </section>

  <!-- YouTube Section - Search -->
  <section class="music-section">
    <h2>ğŸ” Search Music Videos</h2>

    <div class="search-bar">
      <input 
        type="text" 
        [(ngModel)]="youtubeSearchQuery" 
        placeholder="Search for music videos..."
        class="youtube-search-input"
        (keyup.enter)="loadYouTubeVideos(youtubeSearchQuery)">
      <button class="search-btn" (click)="loadYouTubeVideos(youtubeSearchQuery)">
        Search ğŸ”
      </button>
    </div>
    
    <div class="youtube-loading" *ngIf="isYouTubeLoading">
      <p>Loading videos...</p>
    </div>

    <div class="youtube-grid" *ngIf="!isYouTubeLoading && youtubeVideos.length > 0">
      <div class="youtube-card" *ngFor="let video of youtubeVideos">
        <div class="video-thumbnail">
          <iframe 
            [src]="getSafeYoutubeUrl(video.id)"
            width="100%" 
            height="200" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen
            loading="lazy">
          </iframe>
        </div>
        <div class="video-details">
          <h3 class="video-title">{{ video.title }}</h3>
          <p class="video-channel">{{ video.channelTitle }}</p>
        </div>
      </div>
    </div>
  </section>

  <div class="integration-guide">
    <h3>ğŸ”§ API Integration Guide</h3>
    <div class="guide-content">
      <div class="api-card">
        <h4>Spotify Web API</h4>
        <ul>
          <li>Register your app at <a href="https://developer.spotify.com" target="_blank">developer.spotify.com</a></li>
          <li>Get Client ID and Client Secret</li>
          <li>Implement OAuth 2.0 authentication</li>
          <li>Access user playlists, tracks, and player controls</li>
        </ul>
      </div>
      <div class="api-card">
        <h4>YouTube Data API</h4>
        <ul>
          <li>Create project at <a href="https://console.cloud.google.com" target="_blank">Google Cloud Console</a></li>
          <li>Enable YouTube Data API v3</li>
          <li>Generate API key or OAuth credentials</li>
          <li>Fetch playlists, videos, and channel information</li>
        </ul>
      </div>
    </div>
  </div>
</div>
